# Lamoda Tags

Автоматическая генерация тегов для товаров Lamoda на основе отзывов покупателей с использованием LLM.

## Описание

Проект анализирует текстовые отзывы покупателей и генерирует краткие информативные теги, характеризующие товар (качество материала, особенности использования, проблемы и т.д.).

## Установка

```bash
# Создать виртуальное окружение
python3.13 -m venv .venv
source .venv/bin/activate

# Установить зависимости
pip install uv
uv sync
```

## Конфигурация

Задайте переменные окружения для LLM API:

```bash
export OPENAI_BASE_URL="https://your-api-endpoint"
export OPENAI_TOKEN="your-api-key"
export OPENAI_MODEL="model-name"
export MAX_CONCURRENT="2"  # опционально, по умолчанию 2
```

## Скрипты

### `scripts/sample.py`

**Предобработка и сэмплирование данных отзывов.**

Подготавливает данные для генерации тегов:

- Читает исходный файл `lamoda_reviews.csv` с отзывами
- Сэмплирует до 10,000 строк для каждого типа товара (`good_type`) для балансировки датасета
- Группирует все отзывы по товару (`product_sku`) в одну строку (отзывы хранятся как JSON-массив)
- Фильтрует товары с менее чем 4 отзывами
- Сохраняет результат в `lamoda_reviews_sampled.csv`

```bash
python scripts/sample.py
```

**Входные данные:** `lamoda_reviews.csv`  
**Выходные данные:** `lamoda_reviews_sampled.csv`

---

### `scripts/gen_tags.py`

**Генерация тегов с помощью LLM.**

Основной скрипт для анализа отзывов и создания тегов:

- Асинхронная обработка с настраиваемым уровнем параллелизма
- Автоматическое разбиение на чанки для товаров с большим количеством отзывов
- **Идемпотентность** — при повторном запуске продолжает с места остановки
- Генерирует теги на русском языке по строгим правилам (краткость, конкретность, без абстракций)

```bash
# Полный запуск
python scripts/gen_tags.py

# Тестовый режим (только первые 5 товаров)
python scripts/gen_tags.py --test

# Перезапустить обработку неудачных товаров
python scripts/gen_tags.py --reset-failed
```

**Входные данные:** `lamoda_reviews_sampled.csv`  
**Выходные данные:** `lamoda_reviews_sampled_with_tags.csv`

## Структура данных

| Файл | Описание |
|------|----------|
| `lamoda_reviews.csv` | Исходные отзывы (не включён в репозиторий) |
| `lamoda_reviews_sampled.csv` | Сгруппированные отзывы после сэмплирования |
| `lamoda_reviews_sampled_with_tags.csv` | Финальный результат с тегами |

## Пример тегов

Хорошие теги: `Мягкая пена`, `Приятный запах`, `Легкие`, `Заедает замок`

Плохие теги (избегаются): `Хороший товар`, `Рекомендую`, `В размер`, `Популярный`
